'use strict';var _createClass=function(){function a(b,c){for(var e,d=0;d<c.length;d++)e=c[d],e.enumerable=e.enumerable||!1,e.configurable=!0,'value'in e&&(e.writable=!0),Object.defineProperty(b,e.key,e)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),_jsBlake2s=require('js-blake2s'),_jsBlake2s2=_interopRequireDefault(_jsBlake2s),_jsHexi=require('js-hexi'),_jsHexi2=_interopRequireDefault(_jsHexi);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')}var MerkleTree=function(){function a(b){_classCallCheck(this,a),this.state={elements:b.length,hashes:[],deep:0,stage:[],root:null},this._init(b)}return _createClass(a,[{key:'build',value:function build(){var b=this.state.stage[this.state.deep-1];if(1===b.length)return this._constructTree(),this.state;var c=0,d={root:null,left:null,right:null};for(this.state.stage[this.state.deep]=[],c;c<b.length;c++){var e=b[c].root;0==c%2?d.left=e:(d.right=e,d.root=_jsHexi2.default.toBase16(a._hash(_jsHexi2.default.fromBase16(d.left+d.right))),this.state.stage[this.state.deep].push(Object.assign({},d)),d.left=d.right=d.root=null)}return 0!=c%2&&(d.root=d.left,this.state.stage[this.state.deep].push(Object.assign({},d))),this.state.deep++,this.build()}},{key:'_init',value:function _init(b){var c=0,d=[],e={root:null,left:null,right:null};for(c=0;c<b.length;c++){var f=_jsHexi2.default.toBase16(b[c]);this.state.hashes[c]=f,0==c%2?e.left=f:(e.right=f,e.root=_jsHexi2.default.toBase16(a._hash(_jsHexi2.default.fromBase16(e.left+e.right))),d.push(Object.assign({},e)),e.left=null,e.right=null,e.root=null)}0!=c%2&&(e.root=e.left,d.push(Object.assign({},e))),this.state.stage[0]=d,this.state.deep++}},{key:'_constructTree',value:function _constructTree(){var b=this.state.stage;b.reverse(),this.state.root=b[0][0].root}}],[{key:'_hash',value:function _hash(b){return new _jsBlake2s2.default().update(b).digest()}}]),a}();'undefined'!=typeof module&&(module.exports=MerkleTree);
